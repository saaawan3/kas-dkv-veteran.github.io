<!DOCTYPE html>
<html>
<head>
  <title>Kas Sekolah</title>
</head>
<body>
  <h2>Uang Kas Sekolah</h2>
  <button onclick="logout()">Logout</button>

  <h3>Tambah Transaksi</h3>
  <input type="text" id="nama" placeholder="Nama"><br>
  <input type="number" id="nominal" placeholder="Nominal"><br>
  <input type="text" id="ket" placeholder="Keterangan"><br>
  <button onclick="simpan()">Simpan</button>

  <h3>Daftar Transaksi</h3>
  <table border="1" id="tabelKas"></table>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbwDTP08hOuI36EWcdZtICafEDZPHZx_6w-s7JOhHTYjOnP23WShZyX6zWYfhniQY05U/exec"; // Sama dengan di login.html

    if (!localStorage.getItem("loggedIn")) {
      window.location.href = "index.html";
    }

    function logout() {
      localStorage.removeItem("loggedIn");
      window.location.href = "index.html";
    }

    function loadData() {
      fetch(`${API_URL}?action=getData`)
        .then(r => r.json())
        .then(data => {
          let html = "<tr><th>Tanggal</th><th>Nama</th><th>Nominal</th><th>Keterangan</th></tr>";
          data.forEach(row => {
            html += `<tr>
              <td>${row[0]}</td>
              <td>${row[1]}</td>
              <td>${row[2]}</td>
              <td>${row[3]}</td>
            </tr>`;
          });
          document.getElementById("tabelKas").innerHTML = html;
        });
    }

    function simpan() {
      const nama = document.getElementById("nama").value;
      const nominal = document.getElementById("nominal").value;
      const ket = document.getElementById("ket").value;

      fetch(`${API_URL}?action=simpan&nama=${nama}&nominal=${nominal}&keterangan=${ket}`)
        .then(r => r.json())
        .then(res => {
          if (res.success) {
            alert("Data tersimpan!");
            loadData();
          }
        });
    }

    loadData();
  </script>
</body>
</html>
